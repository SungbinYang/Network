> 이 포스트는 [감자](https://www.inflearn.com/course/%EA%B7%B8%EB%A6%BC%EC%9C%BC%EB%A1%9C-%EC%89%BD%EA%B2%8C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC# '감자')님의 강의를 참조하여 작성하였습니다.

## 네트워크 계층

스위치끼리 연결되어 커진 브로드캐스트 도메인은 많은 트래픽이 발생하기 때문에 어떻게든 브로드캐스트 도메인을 나눠줘야 할 것 같습니다. 여기서 어떤 장치를 만들어 브로드캐스트 도메인을 나눴다고 가정하자. 그러면 우리랑 전혀 상관이 없는 미국에 사는 짱구와 철수가 통신하더라도 우리는 브로드캐스트 메세지가 전달되지 않을 것이다. 그러면 쓸데없는 트래픽이 오지 않을 것이다. 여기서 우리가 짱구와 통신을 하고 싶다면 어떻게 될까? 우리가 보내려는 데이터에 출발지 MAC주소는 우리의 MAC주소, 목적지 MAC주소는 짱구의 MAC주소를 적고 스위치로 전송할 것이다. 하지만 스위치는 자신의 MAC주소 테이블에 해당 메세지의 목적지 MAC주소와 일치하는 주소가 없으므로 Flooding을 한다. 그럼 중간에 블랙박스로 데이터가 전송되지만 블랙박스는 자신에게 온 데이터가 아니므로 버릴 것이다. 이런 상황에서는 우리와 짱구는 영영 통신하지 못한다. 이렇게 LAN영역에서 다른 LAN영역으로 넘어가게 되면 기존에 사용하던 출발지, 목적지 MAC주소만으로는 다른 LAN영역에 있는 컴퓨터에 전송하기 힘들다.

이런 문제가 발생하니 사람들은 물리적인 주소인 MAC주소 외에 논리적인 주소를 추가로 만들어야겠다는 생각을 하게 된다. 그리고 브로드캐스트 도메인을 나누는 어떤 장치에 라우터라는 이름을 붙이고 IP주소를 활용해 LAN영역 사이를 문제없이 통신하도록 만들었다. IP주소 덕분에 다른 네트워크에 있는 컴퓨터를 정확하게 나타낼 수 있고 라우터가 복잡한 네트워크에서 경로를 지정할 수 있다. 이전 상황에서 논리적인 주소인 IP주소를 추가하여 통신하는 모습을 보자. 먼저 우리의 PC와 라우터, 짱구의 PC에는 MAC주소뿐만 아니라 IP주소까지 할당된다. 라우터는 여러개의 포트가 있으므로 포트마다 MAC주소와 IP주소가 할당된다. 우리는 짱구에게 데이터를 전송하기 위해서 출발지 IP주소엔 우리의 IP주소, 목적지 IP주소엔 짱구의 IP주소를 적고 출발지 MAC주소엔 우리의 MAC주소, 목적지 MAC주소엔 짱구의 MAC주소가 아닌 라우터의 MAC주소를 적고 전송한다. 그러면 스위치를 통해 라우터로 전달된다. 라우터는 데이터의 목적지 MAC주소를 보고 자신에게 온 데이터인걸 확인하고 목적지 IP를 확인한다. 그리고 받은 메세지에서 IP주소는 바꾸지 않고 출발지 MAC주소는 라우터의 MAC주소, 목적지 MAC주소는 짱구의 MAC주소를 적고 스위치로 전송한다. 마지막으로 스위치는 해당 데이터를 짱구에게 전송하고 짱구는 데이터를 수신한다. 네트워크 계층은 이렇게 다른 LAN영역을 연결하기 위해서 논리적인 주소인 IP주소를 만들어 라우터라는 장치를 이용하는 계층이다. 실제 데이터 전송은 데이터링크 계층, 즉 MAC주소로 하는 것은 달라진 것이 없지만 데이터링크의 한계를 극복하게 해 줬다. 라우터를 넘어가지 않는 영역을 LAN영역이라고 부르고 라우터를 넘어가는 영역을 WAN영역이라 부른다. 네트워크 계층에서는 IP주소와 라우터를 이용해 더 큰 네트워크로 확장하는 방법과 여기서 생긴 문제를 해결하는 프로토콜을 알아보자.

> 이 포스트는 [감자](https://www.inflearn.com/course/%EA%B7%B8%EB%A6%BC%EC%9C%BC%EB%A1%9C-%EC%89%BD%EA%B2%8C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC# '감자')님의 강의를 참조하여 작성하였습니다.

## IP

허브와 스위치로 연결되어 하나의 브로드캐스트 도메인에 있는 네트워크에선 MAC주소만으로 통신할 수 있었다. 하지만 너무 많은 브로드캐스트로 트래픽이 증가하는 걸 해결하기 위해서 논리적인 주소를 만들었는데 이것을 IP주소라고 한다. IP주소는 모든 호스트와 라우터에 할당된다.

> 📚 모든 PC와 라우터의 포트(인터페이스)마다 IP주소 할당. 허브와 스위치는 할당이 안되지만 경우에 따라 할당되는 경우도 존재.

라우터는 IP주소를 이용해서 다른 네트워크에 있는 호스트까지 데이터를 정확하게 전송한다. 그럼 라우터가 IP주소를 어떻게 이용하는지, MAC주소와는 어떤 차이가 있는지 알아보자.

서울에 있는 홍길동이 부산에 있는 임꺽정 집에 가야 하는 상황이라 가정하자. 서울 -> 부산 직행은 없고 대전, 대구를 거쳐서 가야 하는 상황이라고 하자. 홍길동은 서울버스 터미널을 가기 위해서 택시를 타고 택시 기사님께 아래와 같이 말한다.

> 👨‍💼 서울버스 터미널로 가주세요!

그러면 택시기사님은 '서울 버스터미널'이라는 주소를 네비게이션에 입력하고 이동한다. 여기서 출발지 IP주소는 '홍길동 집'이 되고 목적지 IP주소는 '임꺽정 집'이 된다. 출발지 MAC주소는 홍길동 집 주소인 '서울시 은평구 xx길'이고 목적지 MAC주소는 '서울버스 터미널'이 되는 것이다. 서울버스 터미널에 내린 홍길동은 매표소에 이렇게 말한다.

> 👨‍💼임꺽정 집으로 갈건데 표 1개 주세요!

놀랍게도 매표소에는 임꺽정의 개인정보가 저장되어 있어서 직원은 홍길동에게 이렇게 안내한다.

> 👨‍💼 임꺽정 집으로 갈려면 대전행 버스를 타면 돼요!

여기서 매표소는 라우터라고 부르고 매표소에 개인정보가 저장되어 있는 것을 라우팅 테이블이라고 부른다. 대전행 버스를 탄 홍길동은 출발지 IP주소와 목적지 IP주소는 그대로 두고 출발지 MAC주소는 서울버스 터미널, 목적지 MAC주소는 대전버스 터미널로 수정해 이동한다. 대전버스 터미널에 도착한 홍길동은 다시 매표소에서 이렇게 말한다.

> 👨‍💼임꺽정 집으로 갈 건데 표 1개 주세요!

그럼 라우터(직원)는 라우팅 테이블(개인정보)을 참조해 홍길동에게 대구로 가는 표를 준다. 홍길동은 대구행 버스를 탄다. 출발지 MAC주소는 대전버스 터미널, 목적지 MAC주소는 대구버스 터미널로 설정한다. 대구버스 터미널에 도착한 홍길동은 다시 매표소에서 이렇게 말한다.

> 👨‍💼임꺽정 집으로 갈건데 표 1개 주세요!

그럼 라우터는 라우팅 테이블을 참조해 홍길동에게 부산으로 가는 표를 준다. 이제 홍길동은 부산행 버스를 탄다. 출발지 MAC주소는 대구버스 터미널, 목적지 MAC주소는 부산버스 터미널로 설정한다. 부산버스 터미널에 도착한 홍길동은 다시 매표소에서 이렇게 말한다.

> 👨‍💼임꺽정 집으로 갈 건데 표 1개 주세요!

그럼 라우터는 라우팅 테이블을 참조해 홍길동에게 이렇게 말한다.

> 👩🏻‍✈️ 임꺽정은 해운대구 xx길에 살아요. 버스터미널 앞에 택시를 타주세요!

그럼 홍길동은 출발지 MAC주소는 부산버스 터미널, 목적지 MAC주소는 '해운대구 xx길'로 설정하고 택시를 잡아 택시를 탄다.

이렇게 IP주소는 최초 출발지와 최종 목적지 주소를 나타내고 MAC주소를 이용해 실제로 데이터를 전송하기 때문에 중간에 몇 단계의 라우터가 있든 간에 목적지까지 정확하게 데이터가 전송된다. 그러면 실제로 IP주소가 어떻게 생겼는지 보자.

> 192.168.0.1

IP주소는 32bit로 이루어져 있다. 8bit마다 점으로 끊어서 10진수로 표현된 형태이다.
